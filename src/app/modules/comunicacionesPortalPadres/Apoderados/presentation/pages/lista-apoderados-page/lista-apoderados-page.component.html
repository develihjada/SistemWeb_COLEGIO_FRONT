<div class="p-6 bg-gray-50 min-h-screen">
  <!-- Toast/notification: aparece cuando showNewAlert = true -->
  <div *ngIf="showNewAlert" class="fixed right-6 top-6 z-50">
    <div class="max-w-sm w-full bg-white shadow-lg rounded-lg border border-gray-200 overflow-hidden">
      <div class="p-3 flex items-start space-x-3">
        <div class="flex-shrink-0">
          <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4" />
          </svg>
        </div>
        <div class="flex-1">
          <p class="text-sm font-medium text-gray-900">Notificación</p>
          <p class="text-sm text-gray-600">{{ newAlertMessage }}</p>
        </div>
        <div class="flex-shrink-0 pl-2">
          <button (click)="dismissAlert()" class="text-gray-400 hover:text-gray-600">
            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6.293 6.293a1 1 0 011.414 0L10 8.586l2.293-2.293a1 1 0 111.414 1.414L11.414 10l2.293 2.293a1 1 0 01-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 01-1.414-1.414L8.586 10 6.293 7.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Directorio y Gestión de Apoderados</h1>
    <button
      class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 flex items-center"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-2"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
          clip-rule="evenodd"
        />
      </svg>
      Nuevo
    </button>

  </div>

  <div class="bg-white p-4 rounded-xl shadow-lg mb-6 border border-gray-200">
    <div class="grid grid-cols-1 md:grid-cols-7 gap-4 items-end">
      <div class="md:col-span-2">
        <label for="search" class="block text-sm font-medium text-gray-700 mb-1"
          >Buscar Apoderado/Estudiante</label
        >
        <div class="relative">
          <input
            type="text"
            id="search"
            placeholder="Nombre, DNI o Cód. Estudiante..."
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-150"
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
      </div>

      <div>
        <label for="estado-filter" class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
        <select
          id="estado-filter"
          (change)="onEstadoChange($any($event.target).value)"
          class="w-full border border-gray-300 bg-gray-200 text-gray-800 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 transition duration-150"
        >
          <option [value]="2" [selected]="filters.estado === 2"> Todos</option>
          <option *ngFor="let estado of estados" [value]="estado" [selected]="filters.estado === estado">
             {{ estado === 0 ? 'Inhabilitados' : estado === 1 ? 'Activos' : 'Todos' }}
          </option>
        </select>
      </div>

      <div>
        <label for="grado-filter" class="block text-sm font-medium text-gray-700 mb-1">Grado</label>
        <select
          id="grado-filter"
          class="w-full border border-gray-300 bg-gray-200 text-gray-800 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 transition duration-150"
        >
          <option value="">Todos</option>
          <option *ngFor="let grado of grados" [value]="grado">{{ grado }}</option>
        </select>
      </div>

      <div>
        <label for="seccion-filter" class="block text-sm font-medium text-gray-700 mb-1"
          >Sección</label
        >
        <select
          id="seccion-filter"
          class="w-full border border-gray-300 bg-gray-200 text-gray-800 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 transition duration-150"
        >
          <option value="">Todas</option>
          <option *ngFor="let seccion of secciones" [value]="seccion">{{ seccion }}</option>
        </select>
      </div>

      <div>
        <label for="vinculo-filter" class="block text-sm font-medium text-gray-700 mb-1"
          >Vínculo</label
        >
        <select
          id="vinculo-filter"
          class="w-full border border-gray-300 bg-gray-200 text-gray-800 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 transition duration-150"
        >
          <option value="">Todos</option>
          <option *ngFor="let vinculo of vinculos" [value]="vinculo">{{ vinculo }}</option>
        </select>
      </div>

      <div>
        <label for="estado-contacto-filter" class="block text-sm font-medium text-gray-700 mb-1"
          >Estado Cto.</label
        >
        <select
          id="estado-contacto-filter"
          class="w-full border border-gray-300 bg-gray-200 text-gray-800 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 transition duration-150"
        >
          <option value="">Todos</option>
          <option *ngFor="let estado of estadosContacto" [value]="estado">{{ estado }}</option>
        </select>
      </div>

      <div class="flex space-x-2">
        <button
          class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300"
        >
          Aplicar
        </button>
        <button
          class="w-full bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300"
        >
          Limpiar
        </button>
      </div>
    </div>
  </div>

  <div class="bg-white shadow-xl rounded-xl overflow-x-auto">
    <!-- Tabla de datos -->
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Apoderado (DNI)
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Estudiante Relacionado
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Vínculo
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Contacto (Teléfono/Email)
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Estado Portal
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Acciones
          </th>
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-200">
        @defer (on timer(100)) {
        <ng-container *ngIf="apoderadosData$ | async as apoderados">
          <ng-container *ngFor="let apoderado of apoderados; let i = index">
            <tr *ngIf="passesFilter(apoderado)">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                {{ apoderado.nombres || apoderado.apellidos }}
                <span class="text-gray-500 block text-xs">{{ apoderado.ndocumento }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">No hay estudiante</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <span class="font-semibold">{{ apoderado.parentezco }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <p class="text-gray-700 font-medium">{{ apoderado.telefono }}</p>
                <p class="text-xs text-gray-500 truncate max-w-[12rem]">{{ apoderado.email }}</p>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  [class.bg-green-100]="apoderado.estado === 1"
                  [class.text-green-800]="apoderado.estado === 1"
                  [class.bg-red-100]="apoderado.estado === 0"
                  [class.text-red-800]="apoderado.estado === 0"
                >
                  {{ apoderado.estado === 1 ? 'Activo' : apoderado.estado === 0 ? 'Inactivo' : 'N/A' }}
                </span>
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex justify-center space-x-2"
              >
                <button class="text-orange-600 hover:text-orange-900" title="Ver Perfil">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                    <path
                      fill-rule="evenodd"
                      d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </button>
                <button class="text-gray-500 hover:text-gray-900" title="Editar Contacto">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-5.646 9.384L3 16.5V13.5l5.646-5.646 2.828 2.828z"
                    />
                  </svg>
                </button>
              </td>
            </tr>
          </ng-container>
        </ng-container>
        } @placeholder {
        <tr>
          <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
            Cargando apoderados...
          </td>
        </tr>
        } @error {
        <tr>
          <td colspan="6" class="px-6 py-4 text-center text-sm text-red-600 font-semibold">
            ⚠️ No se pudo cargar la lista de apoderados. Intente nuevamente.
          </td>
        </tr>
        }
      </tbody>
    </table>
    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="mb-4 p-3 bg-yellow-50 text-yellow-800 rounded flex items-center">
      <svg class="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24">
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
          fill="none"
        ></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      Cargando apoderados...
    </div>
    <!-- Error banner -->
    <div *ngIf="errorMessage" class="mb-4 p-3 bg-red-50 text-red-700 rounded">
      {{ errorMessage }}
    </div>

    <ng-container *ngIf="!errorMessage">
      <div
      *ngIf="apoderadosData$ | async as apoderados"
      class="p-4 flex justify-between items-center border-t border-gray-200"
    >
      <span class="text-sm text-gray-700"
        >Mostrando 1 a 10 de {{ apoderados.length }} apoderados</span
      >
      <div class="flex space-x-1">
        <button
          class="px-3 py-1 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300"
        >
          Anterior
        </button>
        <button class="px-3 py-1 text-sm font-medium text-white bg-orange-600 rounded-lg shadow">
          1
        </button>
        <button
          class="px-3 py-1 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300"
        >
          2
        </button>
        <button
          class="px-3 py-1 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300"
        >
          Siguiente
        </button>
      </div>
    </div>
    </ng-container>


  </div>
</div>
